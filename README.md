# mstruct-fit-instrument-with-matlab

### Requirements:

- measured data in 'xy' format
- table with positions and intensities of diffraction lines (generated e.g. by PDF2)

#### note:
- adjustments to other data formats is straightforward
- the hkl table can be generated by any software, a screenshot below shows export in Pearson's crystal data

![Pearson's crystal data - hkl table export](/doc/PCD-export-LaB6-table.png)

## Outline

The workflow to receive the instrumental function parameters for MStruct is

1. semi-automatically fit pattern segments in Matlab
2. import fitting result into an Excel worksheet
3. review the instrument polynomial approximation in Excel

## Matlab fitting

This is a semi-automatic procedure. You may want to adjust x-ray wavelength and spectral components ratio,
input patter file name or the whole data import procedure. Two methods for importing the standard peak table
are included. The first one could be used for the hkl table exported from the old version of ICDD PDF2
database. Authors have no idea how to achive that with PDF4, however any similar table is acceptable,
so an input for a table exported from Pearson's Crystal Data is shown. The hkl table should contain
reflections x-positions in the first column and some sort of relative intensities in the third column.

When you start working in Matlab you may need to add directory with some helper fitting and data
import functions to Matlab path.

```Matlab
cd mstruct-fit-instrument-with-matlab
addpath('helper_functions/')
```

As indicated, the procedure is semi-automatic. The Matlab script is paused after fitting each segment
leaving the user an opportunity to inspect the fit in detail. One needs to press 'space' to contine.
The script creates a smple plots with the peak profile parameters in the end.

Profile parameters are saved to **params_1.txt**.
